<!DOCTYPE html><html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>看板</title>
</head>
<style type="text/css">
    .msg_board {
        width: 1200px;
        height: 500px;
        border: solid 1px darkcyan;
        padding: 5px;
        overflow-y: scroll;
    // 文字长度大于div宽度时换行显示
    word-break: break-all;
    }
    /*set srcoll start*/
    ::-webkit-scrollbar
    {
        width: 10px;
        height: 10px;
        background-color: #D6F2FD;
    }
    ::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        /*border-radius: 5px;*/
        background-color: #D6F2FD;
    }
    ::-webkit-scrollbar-thumb
    {
        height: 20px;
        /*border-radius: 10px;*/
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        background-color: #89D7F7;
    }
    /*set srcoll end*/
</style>
<!--页面加载时即启动websocket服务器-->
<!--<body onload="initWebSocket()">-->
<body>
<div id="board" class="msg_board"></div>
<!--<input type="button" value="退出看板" onclick="closeWs()" /><br>-->
<input type="text" name="card_content"/>
<input type="button" value="增加泳道" onclick="add_lane()" /><br>
<input type="text" id="delete_test"/>
<input type="button" value="删除泳道" onclick="delete_lane()"/><br>
<!--卡片容器 测试-->
<div id="lane_container"></div>

</body>
<script type="text/javascript" th:inline="javascript">
    var webSocket;
    var board_id, user_id, action, entity, card_id, panel_id, lane_id, content, description;
    //var r_name = [[${boardName}]];
    var test_lane_id = -1;
    var lane_ids = [];

    // function setJSONObj(content){
    //     var data = {
    //         "board_id": r_name,
    //         "user_id":"5555",
    //         "action":"insert",
    //         "entity":"card",
    //         "card_id":"6666",
    //         "lane_id":"8888",
    //         "content":content,
    //         "description":"lol"
    //     };
    //     return JSON.stringify(data);
    // }

    function add_lane() {
        // if(webSocket != null){
        var div = document.getElementById("board");
        var label = document.createElement("input");
        test_lane_id++;
        lane_ids.push("l"+test_lane_id);
        label.value = "lane"+test_lane_id;
        label.innerText = "lane"+test_lane_id.toString();
        var div_label = document.createElement("div");
        div_label.setAttribute("id", "l"+test_lane_id.toString());
        div_label.setAttribute("width", "1000px");
        div_label.setAttribute("height", "200px");
        div_label.appendChild(label);
        div_label.appendChild(document.createElement("br"));
        div_label.appendChild(document.createElement("br"));
        div.appendChild(div_label);
            // var lane_content = document.getElementsByName("lane_content")[0].value.trim();
            // webSocket.send(setJSONObj(lane_content));
        // }
    }

    function delete_lane(){
        var id = document.getElementById("delete_test").value;
        var board = document.getElementById("board");
        board.removeChild(document.getElementById(lane_ids[id]));
        var index = lane_ids.indexOf(id);
        lane_ids.splice(index, 1);
    }

    function 

    // function closeWs() {
    //     webSocket.close();
    // };

//     function initWebSocket() {
//         var boardName;
//         if(r_name != ""){
//             boardName = r_name;
//         }
//         else{
//             boardName = "init";
//         }
//         if (boardName == null || boardName.length == 0) {
//             alert("请输入房间名");
//             return;
//         }
//         if ("WebSocket" in window) {
// //            alert("您的浏览器支持 WebSocket!");
//             //alert(boardName)
//             if (webSocket == null) {
//                 //var url = "ws://localhost:12345/wstest/" + boardName;
//                 var url = "ws://localhost:12345/wstest/";
//                 // 打开一个 web socket
//                 webSocket = new WebSocket(url);
//             } else {
//                 alert("您已进入看板...");
//             }
//
//             webSocket.onopen = function () {
//                 alert("已进入看板...");
//             };
//
//             webSocket.onmessage = function (evt) {
//                 var msg_board = document.getElementsByClassName("msg_board")[0];
//                 var received_msg = evt.data;
//                 var rec = eval("("+received_msg+")");
//                 board_id = rec["board_id"];
//                 user_id = rec["user_id"];
//                 action = rec["action"];
//                 entity = rec["entity"];
//                 card_id = rec["card_id"];
//                 panel_id = rec["panel_id"];
//                 lane_id = rec["lane_id"];
//                 content = rec["content"];
//                 description = rec["description"];
//                 var old_msg = msg_board.innerHTML;
//                 msg_board.innerHTML = old_msg + received_msg + "<br>";
//                 // 让滚动块往下移动
//                 msg_board.scrollTop = msg_board.scrollTop + 40;
//             };
//
//             webSocket.onclose = function () {
//                 // 关闭 websocket，清空信息板
//                 alert("连接已关闭...");
//                 webSocket = null;
//                 document.getElementsByClassName("msg_board")[0].innerHTML = "";
//             };
//         }
//         else {
//             // 浏览器不支持 WebSocket
//             alert("您的浏览器不支持 WebSocket!");
//         }
//     }
</script>
</html>